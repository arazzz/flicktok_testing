---
/** General */
import { ViewTransitions } from "astro:transitions";

/** Props */
const { title, description, ...props } = Astro.props;
---

<!doctype html>
<html lang="en" class="w-full h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content={description || ""} />
    <meta name="color-scheme" content="light dark" />
    <title>{title} | Flicktok</title>
    <ViewTransitions />
  </head>
  <body
    id="root"
    class="w-full h-full min-w-min min-h-min border-slate-900 border-4 relative"
  >
    <slot />
    <script type="module">
      // @ts-nocheck
      import IPCEventHandler from "/src/lib/IPCEventHandler.js";
      import globalStore from "/src/stores/global.store.js";

      globalStore.__fns.initialize();

      const cb = () => {
        if (typeof window.api === "undefined") return;
        window.api.receive("fromMain", (data) => {
          console.info("Received from main process:", data);
          IPCEventHandler(data);
        });
      };
      document.addEventListener("astro:page-load", cb, { once: true });

      document.addEventListener("astro:after-swap", () => {
        if (typeof window.api === "undefined") return;
        window.api.send("toMain", {
          id: "navigated-to",
          data: { url: window.location.href },
        });
      });

      // // Clear event listeners on page unload
      // document.addEventListener("astro:before-swap", () => {
      //   document.removeEventListener("astro:page-load", cb);
      //   document.removeEventListener("astro:before-swap", this);
      // });
    </script>
  </body>
</html>
